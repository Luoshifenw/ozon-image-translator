# 🚀 云服务器部署计划

## 服务器信息
- **公网 IP**: 47.243.77.183
- **配置**: 2核2G ESSD云盘 40GB
- **到期时间**: 2026年1月21日
- **状态**: ✅ 已购买

---

## 📋 阶段 1：完善本地代码（预计 2-3 小时）

### 目标
实现 URL 模式支持，为云端部署做准备

### 任务清单

#### 1.1 添加临时文件访问端点
- [ ] 在 `routers/translate.py` 添加 `/api/temp-images/{request_id}/{filename}` 端点
- [ ] 实现安全路径检查
- [ ] 测试端点是否可访问

#### 1.2 实现存储模式切换
- [ ] 在 `config.py` 添加 `STORAGE_MODE` 配置（local/cloud）
- [ ] 添加 `BASE_URL` 配置
- [ ] 修改 `translation.py` 支持两种模式：
  - `local` 模式：使用 Base64（本地开发）
  - `cloud` 模式：使用服务器 URL（生产环境）

#### 1.3 优化配置文件
- [ ] 更新 `config.py`
- [ ] 更新 `.env.example` 添加云端配置示例
- [ ] 添加配置验证逻辑

#### 1.4 代码提交
- [ ] 测试本地功能正常
- [ ] 提交代码到 GitHub
- [ ] 打版本标签 `v0.1.0`

### 需要用户提供
- [ ] **域名信息**（如果有）或确认使用 IP
  - 有域名: ____________
  - 使用 IP: http://47.243.77.183

---

## 📋 阶段 2：服务器初始化（预计 1 小时）

### 目标
准备服务器环境，安装必要软件

### 任务清单

#### 2.1 连接服务器
- [ ] 获取 SSH 登录信息
  - 用户名: ____________
  - 密码: ____________
  - 端口: 22（默认）
- [ ] 测试 SSH 连接

#### 2.2 检查服务器环境
- [ ] 查看系统版本: `uname -a`
- [ ] 检查 Docker: `docker --version`
- [ ] 检查 Docker Compose: `docker-compose --version`

#### 2.3 安装必要软件（如果没有）
- [ ] 安装 Docker
- [ ] 安装 Docker Compose
- [ ] 安装 Git

#### 2.4 配置防火墙
- [ ] 开放端口 80（HTTP）
- [ ] 开放端口 443（HTTPS，如果需要）
- [ ] 开放端口 22（SSH）

#### 2.5 准备部署脚本
- [ ] 创建 `deploy.sh`（一键部署脚本）
- [ ] 创建 `DEPLOY.md`（部署文档）
- [ ] 优化 `docker-compose.yml`（生产环境配置）

### 需要用户提供
- [ ] **SSH 连接信息**
- [ ] **端口偏好**（前端：80 或 8080？）
- [ ] **HTTPS 需求**
  - [ ] 需要 HTTPS（需要域名）
  - [ ] 暂时用 HTTP

---

## 📋 阶段 3：部署到云服务器（预计 2 小时）

### 目标
将应用部署到生产环境

### 任务清单

#### 3.1 上传代码到服务器
- [ ] 在服务器上克隆 GitHub 仓库
- [ ] 或通过 rsync/scp 上传代码

#### 3.2 配置环境变量
- [ ] 创建生产环境 `.env` 文件
- [ ] 配置 API Key
- [ ] 配置 `STORAGE_MODE=cloud`
- [ ] 配置 `BASE_URL`（域名或 IP）

#### 3.3 构建和启动服务
- [ ] 运行 `docker-compose build`
- [ ] 运行 `docker-compose up -d`
- [ ] 检查容器状态: `docker-compose ps`
- [ ] 查看日志: `docker-compose logs -f`

#### 3.4 配置域名（如果有）
- [ ] 域名解析指向服务器 IP
- [ ] 配置 Nginx 反向代理
- [ ] 配置 HTTPS 证书（Let's Encrypt）

#### 3.5 测试访问
- [ ] 访问前端: http://47.243.77.183 或 https://yourdomain.com
- [ ] 测试后端 API: `/api/health` 或类似端点
- [ ] 测试临时文件访问端点

### 需要用户提供
- [ ] **APIMart API Key**（已有）
- [ ] 确认所有配置信息

---

## 📋 阶段 4：测试和优化（预计 1-2 小时）

### 目标
验证功能，优化性能

### 任务清单

#### 4.1 功能测试
- [ ] 上传单张图片测试
- [ ] 上传多张图片测试（2-5张）
- [ ] 验证翻译质量（图片内容是否相关）
- [ ] 测试下载功能

#### 4.2 性能监控
- [ ] 查看 Docker 资源占用: `docker stats`
- [ ] 查看后端日志（错误、警告）
- [ ] 监控 API 响应时间

#### 4.3 问题修复
- [ ] 记录所有问题
- [ ] 修复 bug
- [ ] 优化性能瓶颈

#### 4.4 文档更新
- [ ] 更新 README.md
- [ ] 更新 API_INTEGRATION_SUMMARY.md
- [ ] 记录已知问题和解决方案

### 需要用户提供
- [ ] **测试图片**（几张 Ozon 商品图）
- [ ] **测试反馈**（翻译质量、速度、稳定性）

---

## 📋 阶段 5：商业化准备（后续，1周）

### 目标
为商业化运营做准备

### 任务清单（按优先级）

#### 5.1 最小可行商业化（P1）
- [ ] 设计数据库 ER 图
- [ ] 实现 API Key 系统
- [ ] 添加用量统计和限制
- [ ] 简单的管理后台

#### 5.2 监控和日志（P1）
- [ ] 配置日志收集
- [ ] 设置错误告警
- [ ] 性能监控面板

#### 5.3 用户系统（P2）
- [ ] 用户注册/登录
- [ ] 个人中心
- [ ] 支付集成

---

## 📊 当前进度

- [x] ✅ 项目初始化
- [x] ✅ 基础功能开发
- [x] ✅ APIMart API 集成
- [x] ✅ Base64 优化和错峰发送
- [x] ✅ GitHub 仓库创建
- [x] ✅ 服务器购买
- [ ] ⏳ **当前：阶段 1 - 完善本地代码**
- [ ] 🔜 阶段 2 - 服务器初始化
- [ ] 🔜 阶段 3 - 云端部署
- [ ] 🔜 阶段 4 - 测试优化
- [ ] 🔜 阶段 5 - 商业化准备

---

## 🔗 相关文档

- [README.md](./README.md) - 项目说明
- [PROGRESS.md](./PROGRESS.md) - 开发进度
- [API_INTEGRATION_SUMMARY.md](./API_INTEGRATION_SUMMARY.md) - API 集成文档
- [.cursorrules](./.cursorrules) - 项目规范

---

## 📝 备注

### 重要决策
1. ✅ 不使用 OSS，直接用服务器临时目录
2. ✅ 采用"即用即走"的设计理念
3. ✅ 分阶段实施，先验证核心功能

### 风险和注意事项
- ⚠️ 服务器资源有限（2核2G），需要注意并发性能
- ⚠️ 临时文件清理机制必须可靠，避免磁盘占满
- ⚠️ API Key 等敏感信息必须妥善保管
- ⚠️ 需要监控翻译质量和成功率

### 成本估算
- ✅ 服务器：已购买（到 2026年1月）
- ✅ APIMart API：按量付费
- ✅ 域名（可选）：~50元/年
- ✅ HTTPS 证书：免费（Let's Encrypt）


